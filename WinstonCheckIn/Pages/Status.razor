@using WinstonCheckIn.Services
@using System.ComponentModel
@using MudBlazor
@page "/status"
@inject CheckInService CheckInService
@implements IDisposable

<PageTitle>Status</PageTitle>

<h1>Check-In Status</h1>

<p>View all check-in records below.</p>

@if (CheckInService.CheckInRecords.Any())
{
    <div class="mt-4">
        @foreach (var record in CheckInService.CheckInRecords)
        {
            <div class="d-flex align-items-center py-1 px-0" style="border-bottom: 1px solid #e0e0e0;">
                <div class="flex-grow-1 d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <span style="font-size: 14px;">
                            <strong>@record.FirstName @record.LastName</strong> - @record.Phone
                        </span>
                    </div>
                    <div class="d-flex align-items-center">
                        <MudChip T="string" Color="@(record.IsPaid ? Color.Success : Color.Error)" 
                                Size="Size.Small" 
                                Variant="Variant.Filled">
                            @(record.IsPaid ? "Paid" : "Unpaid")
                        </MudChip>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="mt-4">
        <MudText>No check-in records found.</MudText>
    </div>
}

@code {
    protected override void OnInitialized()
    {
        CheckInService.PropertyChanged += OnCheckInServiceChanged;
    }

    private void OnCheckInServiceChanged(object? sender, PropertyChangedEventArgs e)
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        CheckInService.PropertyChanged -= OnCheckInServiceChanged;
    }
}